<!DOCTYPE html>
<html lang="en">
<head>
    <title>todo</title>
</head>

<body>

    <div> 
        <input id="title" type="text" placeholder="Title"></input></br><br>
        <input id="description" type="text" placeholder="Description"></input><br><br>
        <button onclick="add()">Add</button>
    </div>
    <div id="todo"></div>
    <script>
        let id = 0; // unique id for each todo item

        function createChild(title, description, id){
            const child = document.createElement('div');
            child.id = `todo-${id}`;
            const titleElement = document.createElement('h2');
            titleElement.innerHTML = title;
            const descriptionElement = document.createElement('p');
            descriptionElement.innerHTML = description;
            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = 'delete';
            deleteButton.setAttribute('onclick', `deleteTodo(${id})`);
            const markButton = document.createElement('button');
            markButton.innerHTML = 'Mark done!';
            markButton.setAttribute('onclick', `doneTodo(${id})`);
            child.appendChild(titleElement);
            child.appendChild(descriptionElement);
            child.appendChild(deleteButton);
            child.appendChild(markButton);
            return child;
        }

        // function add() {
        //     const title = document.querySelector('#title').value;
        //     const description = document.querySelector('#description').value;
        //     const todo = document.querySelector('#todo');
        //     // document.querySelector('#todo').innerHTML = todo + `<div id="todo-${id}"><h2>${title.value}</h2><p>${description.value}</p><br><button onclick="deleteTodo(${id})">delete</button><button id="mark-${id}" onclick="doneTodo(${id})">Mark done!</button></div>`;
        //     todo.appendChild(createChild(title, description, id));
        //     id++;
        // }

        function updateDomAccToState(state){
            const todo = document.querySelector('#todo');
            todo.innerHTML = '';
            state.forEach(todoItem => {
                todo.appendChild(createChild(todoItem.title, todoItem.description, todoItem.id));
            });
        }

        function deleteTodo(id) {
            const todoItem = document.querySelector(`#todo-${id}`);
            todoItem.remove();
        }

        function doneTodo(id) {
            const todoItem = document.querySelector(`#todo-${id}`);
            todoItem.style.textDecoration = 'line-through';
            const markButton = document.querySelector(`#mark-${id}`);
            markButton.remove();
        }

        window.setInterval(async ()=>{
            const res = await fetch("https://localhost:3000/todos");
            const data = await res.json();
            updateDomAccToState(data.todos);
        },1000)
    </script>

</html>